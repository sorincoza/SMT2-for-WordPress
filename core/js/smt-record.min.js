/*
 Dual licensed under the MIT (MIT-LICENSE.txt) and GPL (GPL-LICENSE.txt) licenses.
 @see smt2fn
*/
(function(){var d={fps:24,recTime:3600,postInterval:30,trackingServer:"",storageServer:"",warn:!1,warnText:"We'd like to study your mouse activity.\nDo you agree?",cookieDays:365,layoutType:"liquid",contRecording:!0,compress:!0,disabled:0},c=window.smt2fn;if("undefined"===typeof c)throw"Auxiliar (smt)2 functions not found";var b={i:0,mouse:{x:0,y:0},page:{width:0,height:0},coords:{x:[],y:[],p:[]},elem:{hovered:[],clicked:[]},url:null,rec:null,userId:null,smtId:null,append:null,paused:!1,clicked:!1,
timestamp:null,timeout:null,xmlhttp:c.createXMLHTTPObject(),ftu:1,pauseRecording:function(){b.paused=!0},resumeRecording:function(){b.paused=!1},getMousePos:function(a){a||(a=window.event);var e=0,c=0;if(a.pageX||a.pageY)e=a.pageX,c=a.pageY;else if(a.clientX||a.clientY)e=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;if(0>e||!e)e=0;if(0>c||!c)c=0;b.mouse.x=e;b.mouse.y=c},getMousePosIFrame:function(a,e){b.pause=
!1;var c=a.pageX||a.clientX,d=a.pageY||a.clientY,f=e.contentDocument||e.contentWindow;f.body&&(c-=f.body.scrollLeft,d-=f.body.scrollTop);f.documentElement&&(c-=f.documentElement.scrollLeft,d-=f.documentElement.scrollTop);f=b.getFrameOffsets(e);c+=f.left;d+=f.top;b.mouse.x=c;b.mouse.y=d},getFrameOffsets:function(a){a=a&&a.frameElement?a.frameElement:a;var b=0,c=0;if(a&&a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent)}return{left:b,top:c}},setClick:function(){b.clicked=!0},
releaseClick:function(){b.clicked=!1},recMouse:function(){b.paused||(b.i<=b.timeout?(b.coords.x.push(b.mouse.x),b.coords.y.push(b.mouse.y),b.coords.p.push(+b.clicked)):(clearInterval(b.rec),clearInterval(b.append)),++b.i)},getCursorDataFields:function(){var a="&pagew="+b.page.width,a=a+("&pageh="+b.page.height);d.compress?(a+="&xcoords="+c.LZW.compress(b.coords.x.join(",")),a+="&ycoords="+c.LZW.compress(b.coords.y.join(",")),a+="&clicks="+c.LZW.compress(b.coords.p.join(",")),a+="&elhovered="+c.LZW.compress(b.elem.hovered.join(",")),
a+="&elclicked="+c.LZW.compress(b.elem.clicked.join(",")),a+="&compressed=1"):(a+="&xcoords="+b.coords.x,a+="&ycoords="+b.coords.y,a+="&clicks="+b.coords.p,a+="&elhovered="+b.elem.hovered,a+="&elclicked="+b.elem.clicked);return a},initMouseData:function(a){b.computeAvailableSpace();var c="client="+b.smtId,c=c+("&url="+b.url),c=c+("&urltitle="+document.title),c=c+("&cookies="+document.cookie),c=c+("&screenw="+screen.width),c=c+("&screenh="+screen.height),c=c+("&layout="+d.layoutType),c=c+("&time="+
b.getBrowsingTime()),c=c+("&fps="+d.fps),c=c+("&ftu="+b.ftu),c=c+b.getCursorDataFields(),c=c+"&action=store"+("&remote="+d.storageServer);b.sendData({async:a,postdata:c,callback:b.setUserId});b.clearMouseData()},setTrackingId:function(){var a;c.cookies.checkCookie("smt-id")?a=c.cookies.getCookie("smt-id"):(a=md5(String(Math.random()+(new Date).getTime()*Math.random())),c.cookies.setCookie("smt-id",a,d.cookieDays));b.smtId=a},setUserId:function(a){b.userId=parseInt(a);0<b.userId&&(b.append=setInterval(function(){b.appendMouseData(!0)},
1E3*d.postInterval))},getBrowsingTime:function(){return((new Date).getTime()-b.timestamp)/1E3},appendMouseData:function(a){if(!b.rec||b.paused)return!1;var c="uid="+b.userId,c=c+("&time="+b.getBrowsingTime()),c=c+b.getCursorDataFields(),c=c+"&action=append"+("&remote="+d.storageServer);b.sendData({async:a,postdata:c});b.clearMouseData()},sendData:function(a){a.url=c.ensureLastURLSlash(d.trackingServer)+"core/gateway.php";a.xmlhttp=b.xmlhttp;c.sendAjaxRequest(a)},flushData:function(){b.userId?b.appendMouseData(!1):
b.initMouseData(!1)},clearMouseData:function(){b.coords.x=[];b.coords.y=[];b.coords.p=[];b.elem.hovered=[];b.elem.clicked=[]},findElement:function(a){a||(a=window.event);c.widget.findDOMElement(a,function(c){"mousedown"==a.type||"touchstart"==a.type?b.elem.clicked.push(c):"mousemove"!=a.type&&"touchmove"!=a.type||b.elem.hovered.push(c)})},computeAvailableSpace:function(){var a=c.getPageSize();b.page.width=a.width;b.page.height=a.height},trackIFrames:function(a){a=a.getElementsByTagName("iframe");
for(var d,h,g,f=function(a){c.addEvent(a,"mousedown",b.setClick);c.addEvent(a,"mouseup",b.releaseClick);c.addEvent(a,"touchstart",b.setClick);c.addEvent(a,"touchend",b.releaseClick)},k=0,l=a.length;k<l;++k)try{if(d=window.opera?a[k]:a[k].contentWindow||a[k].contentDocument,d.attachEvent&&!window.opera){var m=a[k].cloneNode(!0);a[k].parentNode.replaceChild(m,a[k]);a[k].onreadystatechange=function(a){"complete"===this.readyState&&(g=this.contentWindow,h=g.document,c.addEvent(h,"mousemove",function(a){b.getMousePosIFrame(this.parentWindow.event,
this.frames.frameElement)}),c.addEvent(h,"touchmove",function(a){b.getMousePosIFrame(this.parentWindow.event,this.frames.frameElement)}),f(h))}}else d.frameElement&&(d=d.frameElement),c.addEvent(d,"load",function(a){g=a.target||a.srcElement;h=g.contentDocument;c.addEvent(h,"mousemove",function(a){b.getMousePosIFrame(a,g)});c.addEvent(h,"touchmove",function(a){b.getMousePosIFrame(a,g)});f(h)})}catch(n){console.warn(n)}},keyHandler:function(a){},init:function(){b.setTrackingId();b.computeAvailableSpace();
b.url=escape(window.location.href);b.timeout=d.fps*d.recTime;var a=Math.round(1E3/d.fps);b.rec=setInterval(b.recMouse,a);c.allowTrackingOnFlashObjects(document);b.trackIFrames(document);var a=function(a){a.touches&&(a=a.touches[0]||a.targetTouches[0]);b.getMousePos(a);b.findElement(a)},e=function(a){a.touches&&(a=a.touches[0]||a.targetTouches[0]);b.setClick();b.findElement(a)};c.addEvent(document,"mousedown",e);c.addEvent(document,"mousemove",a);c.addEvent(document,"mouseup",b.releaseClick);c.addEvent(document,
"touchstart",e);c.addEvent(document,"touchmove",a);c.addEvent(document,"touchend",b.releaseClick);c.addEvent(window,"resize",b.computeAvailableSpace);c.addEvent(window,"orientationchange",b.computeAvailableSpace);d.contRecording||(document.attachEvent&&!window.opera?(c.addEvent(document.body,"focusout",b.pauseRecording),c.addEvent(document.body,"focusin",b.resumeRecording)):(c.addEvent(window,"blur",b.pauseRecording),c.addEvent(window,"focus",b.resumeRecording)));"function"==typeof window.onbeforeunload?
c.addEvent(window,"beforeunload",b.flushData):c.addEvent(window,"unload",b.flushData);setTimeout(function(){b.initMouseData(!0)},1E3*d.postInterval);b.timestamp=(new Date).getTime()}};window.smt2={methods:b,record:function(a){"undefined"!==typeof a&&c.overrideTrackingOptions(d,a);a=c.cookies.getCookie("smt-ftu");if(!d.disabled||!a){b.ftu=!a|0;c.cookies.setCookie("smt-ftu",b.ftu,d.cookieDays);if(d.warn)if(c.cookies.checkCookie("smt-agreed")?c.cookies.getCookie("smt-agreed"):window.confirm(d.warnText))c.cookies.setCookie("smt-agreed",
1,d.cookieDays);else return c.cookies.setCookie("smt-agreed",0,1),!1;a=document.getElementsByTagName("script");for(var e=0,h=a.length;e<h;++e){var g=a[e].src;if(/smt-record/i.test(g)){var g=g.split("/"),f=c.array.indexOf(g,"smt2");f&&!d.trackingServer&&(d.trackingServer=g.slice(0,f+1).join("/"))}}c.onDOMload(b.init)}}}})();